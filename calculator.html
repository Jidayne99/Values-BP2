<!-- ─────────────────────────────────────────────────────────────────── -->
<section id="auto-calculator" style="margin:40px auto; max-width:900px;">

  <h2 style="text-align:center; color:#0ff; text-shadow:0 0 8px #0ff; font-family:'Orbitron';">
    🔮 Auto Trade Calculator
  </h2>

  <div class="trade‑grid" style="
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:24px;
    margin-top:20px;
  ">
    <!-- Your Offer -->
    <div style="background:#111; padding:16px; border:2px solid #0ff; border-radius:8px;">
      <h3 style="color:#ff8c00; text-shadow:0 0 6px #ff8c00; font-family:'Orbitron';">
        ➤ Your Offer
      </h3>
      <div style="display:flex; margin-bottom:8px;">
        <input id="your-input" list="itemList" placeholder="Type to search..."
               style="flex:1; padding:8px; border:1px solid #0ff; border-radius:4px 0 0 4px; background:#222; color:#0ff; font-family:'Orbitron';"/>
        <button id="add-your" style="
          padding:8px; background:linear-gradient(45deg,#00f,#f80);
          border:none; border-radius:0 4px 4px 0; color:#000;
          font-weight:bold; cursor:pointer; box-shadow:0 0 5px #00f,0 0 5px #f80;
        ">Add</button>
      </div>
      <ul id="your-list" style="list-style:none; padding:0; max-height:200px; overflow-y:auto;"></ul>
    </div>

    <!-- Their Offer -->
    <div style="background:#111; padding:16px; border:2px solid #0ff; border-radius:8px;">
      <h3 style="color:#ff8c00; text-shadow:0 0 6px #ff8c00; font-family:'Orbitron';">
        ➤ Their Offer
      </h3>
      <div style="display:flex; margin-bottom:8px;">
        <input id="their-input" list="itemList" placeholder="Type to search..."
               style="flex:1; padding:8px; border:1px solid #0ff; border-radius:4px 0 0 4px; background:#222; color:#0ff; font-family:'Orbitron';"/>
        <button id="add-their" style="
          padding:8px; background:linear-gradient(45deg,#00f,#f80);
          border:none; border-radius:0 4px 4px 0; color:#000;
          font-weight:bold; cursor:pointer; box-shadow:0 0 5px #00f,0 0 5px #f80;
        ">Add</button>
      </div>
      <ul id="their-list" style="list-style:none; padding:0; max-height:200px; overflow-y:auto;"></ul>
    </div>
  </div>

  <div style="text-align:center; margin-top:24px;">
    <button id="compare-btn" style="
      padding:12px 24px; font-family:'Orbitron'; font-size:1rem;
      background:linear-gradient(45deg,#0ff,#f80); color:#000;
      border:none; border-radius:6px; cursor:pointer;
      box-shadow:0 0 8px #0ff,0 0 8px #f80; transition:0.3s;
    ">Analyze Trade</button>
  </div>

  <div id="result" style="
    margin-top:24px; padding:16px; text-align:center;
    background:#111; border:2px solid #0ff; border-radius:8px;
    box-shadow:0 0 10px rgba(0,255,255,0.3);
    font-family:'Orbitron'; font-size:1.2rem; color:#0ff;
    white-space:pre-line;
  ">Result will appear here</div>

  <!-- shared datalist for autocomplete -->
  <datalist id="itemList"></datalist>
</section>

<script>
(() => {
  // 1) Extract every item from your existing tables:
  const rows = document.querySelectorAll('.category table tbody tr');
  const items = Array.from(rows).map(r => {
    const cols = r.children;
    const name = cols[0].textContent.trim();
    // pick OG value if numeric, else parse tag value
    let val = parseFloat(cols[1].textContent) || 
              parseFloat(cols[2].textContent.replace(/[^0-9.]/g,'')) || 0;
    const demandRaw = cols[3].textContent.trim().split('/')[0];
    const dem = parseFloat(demandRaw) || 0;
    return { name, value: val, demand: dem };
  });

  // 2) Populate the datalist
  const dl = document.getElementById('itemList');
  items.forEach(it => {
    const o = document.createElement('option');
    o.value = it.name;
    dl.appendChild(o);
  });

  // 3) Setup add‐item logic
  const yourListEl = document.getElementById('your-list');
  const theirListEl = document.getElementById('their-list');
  let yourItems = [], theirItems = [];

  function addItem(side) {
    const input = document.getElementById(side+'-input');
    const listEl = side==='your' ? yourListEl : theirListEl;
    const arr = side==='your' ? yourItems : theirItems;
    const name = input.value.trim();
    input.value = '';
    const item = items.find(i => i.name === name);
    if(!item) return alert('Not found: '+name);
    if(arr.some(i=>i.name===name)) return alert('Already added');
    arr.push(item);
    // render list item
    const li = document.createElement('li');
    li.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:4px 8px;border:1px solid #444;border-radius:4px;margin:4px 0;background:#222;';
    li.innerHTML = `<span>${item.name} &nbsp;|&nbsp; Val:${item.value} &nbsp;|&nbsp; Dem:${item.demand}</span>
                    <button style="background:#f55;border:none;color:#fff;padding:2px 6px;cursor:pointer;">✖</button>`;
    li.querySelector('button').onclick = () => {
      listEl.removeChild(li);
      const idx = arr.findIndex(x=>x.name===item.name);
      arr.splice(idx,1);
    };
    listEl.appendChild(li);
  }

  document.getElementById('add-your').onclick = ()=>addItem('your');
  document.getElementById('add-their').onclick = ()=>addItem('their');

  // 4) Analyze on click
  document.getElementById('compare-btn').onclick = () => {
    const R = document.getElementById('result');
    if(!yourItems.length||!theirItems.length) {
      return R.textContent = '⚠️ Add at least one item per side.';
    }
    // totals
    const sum = arr => arr.reduce((s,i)=>s+i.value,0);
    const dem = arr => arr.reduce((s,i)=>s+i.demand,0);
    const vY = sum(yourItems), dY = dem(yourItems);
    const vT = sum(theirItems), dT = dem(theirItems);
    // weighted score
    const sY = 0.7*vY + 0.3*dY;
    const sT = 0.7*vT + 0.3*dT;
    // partial results
    const part = 
      (dY>dT?'WIN':'TIE')+' in demand, '+
      (vY>vT?'WIN':'TIE')+' in value';
    // final
    let final = Math.abs(sY - sT)/Math.max(sY,sT) < 0.05 ? 'FAIR'
               : sY > sT ? 'WIN' : 'LOSE';
    // compose display
    const leftNames = yourItems.map(i=>i.name).join(' + ');
    const rightNames= theirItems.map(i=>i.name).join(' + ');
    R.innerHTML = `
      🔹 <strong>Partial:</strong> ${part}
      <br/>
      🔮 <strong>Final Result:</strong><br/>
      ${leftNames} for ${rightNames} → 
      <span style="
        color:${ final==='WIN'? '#0f0'
                : final==='LOSE'? '#f00'
                : '#ff0' };
        font-size:1.4em;
        text-shadow:0 0 6px;
        ">
        ${final}
      </span>
    `;
  };
})();
</script>
