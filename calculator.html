<!-- ====== Trade Calculator Section (paste after all your existing tables) ====== -->
<section id="trade-calculator" style="--btn-grad: linear-gradient(45deg, #00f, #0ff); --bg-color: #0a0a0a;">
  <h2 style="text-align:center; color:#0ff; text-shadow:0 0 8px #0ff;">⚡ Smart Trade Analyzer ⚡</h2>
  <div class="calc-wrap">
    <div class="side">
      <h3>Your Offer</h3>
      <ul class="item-list" id="your-list"></ul>
      <div class="add-row">
        <input id="your-input" list="itemsDatalist" placeholder="Type to search…" />
        <button id="add-your">Add</button>
      </div>
    </div>
    <div class="side">
      <h3>Their Offer</h3>
      <ul class="item-list" id="their-list"></ul>
      <div class="add-row">
        <input id="their-input" list="itemsDatalist" placeholder="Type to search…" />
        <button id="add-their">Add</button>
      </div>
    </div>
  </div>
  <datalist id="itemsDatalist"></datalist>
  <div id="result-box">
    <p id="totals"></p>
    <p id="verdict"></p>
  </div>
</section>

<style>
  :root {
    --btn-grad: linear-gradient(45deg, #00f, #0ff);
    --bg-color: #0a0a0a;
    --text-glow: 0 0 6px #0ff;
  }
  #trade-calculator {
    background: var(--bg-color);
    border: 2px solid #0ff;
    border-radius: 12px;
    padding: 20px;
    max-width: 900px;
    margin: 40px auto;
    font-family: 'Orbitron', sans-serif;
    box-shadow: 0 0 15px rgba(0,255,255,0.4);
  }
  .calc-wrap {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }
  .side {
    flex: 1;
    min-width: 280px;
    background: #111;
    border: 1px solid #0ff;
    border-radius: 8px;
    padding: 15px;
  }
  .side h3 {
    margin-top:0; color:#0ff; text-shadow: var(--text-glow);
  }
  .add-row {
    display: flex;
    margin-top: 10px;
  }
  .add-row input {
    flex:1;
    padding:8px;
    background:#222; color:#0ff;
    border:1px solid #0ff; border-radius:4px 0 0 4px;
  }
  .add-row button {
    padding:8px 12px;
    background: var(--btn-grad);
    border:none; color:#000; font-weight:bold;
    border-radius:0 4px 4px 0;
    cursor:pointer; transition:0.3s;
  }
  .add-row button:hover {
    filter: brightness(1.1);
  }
  .item-list {
    list-style:none; padding:0; margin:0;
    max-height:160px; overflow-y:auto;
  }
  .item-list li {
    display:flex; justify-content:space-between;
    align-items:center; padding:6px 10px;
    background:#222; margin:4px 0;
    border-radius:4px; border:1px solid #0ff;
  }
  .item-list li span {
    color:#0ff;
  }
  .item-list li button {
    background:#f55; color:#fff; border:none;
    border-radius:4px; padding:2px 6px; cursor:pointer;
  }
  #result-box {
    margin-top:20px; padding:15px;
    background:#111; border:1px solid #0ff;
    border-radius:8px; text-align:center;
    box-shadow:0 0 8px rgba(0,255,255,0.3);
  }
  #result-box p {
    margin:8px 0; font-size:1.1em;
  }
  #totals { color:#0ff; text-shadow:var(--text-glow); }
  #verdict.win { color:#0f0; text-shadow:0 0 6px #0f0; }
  #verdict.fair { color:#ff0; text-shadow:0 0 6px #ff0; }
  #verdict.lose { color:#f00; text-shadow:0 0 6px #f00; }

  @media(max-width:600px){
    .calc-wrap { flex-direction:column; }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', ()=> {
  // 1) Extract all items from YOUR tables
  const items = [];
  document.querySelectorAll('.category table tbody').forEach(tbody=>{
    tbody.querySelectorAll('tr').forEach(row=>{
      const cells = row.children;
      const name = cells[0]?.textContent.trim();
      const val = parseFloat(cells[1]?.textContent) || 0;
      const demMatch = cells[3]?.textContent.match(/(\d+)\/10/);
      const demand = demMatch ? parseInt(demMatch[1]) : 0;
      if(name) items.push({name, value: val, demand});
    });
  });

  // 2) Populate datalist for autocomplete
  const dl = document.getElementById('itemsDatalist');
  items.forEach(i=>{
    const opt = document.createElement('option');
    opt.value = i.name;
    dl.appendChild(opt);
  });

  // 3) Helper to manage each side
  function makeAdder(side){
    const listEl = document.getElementById(side+'-list');
    const input = document.getElementById(side+'-input');
    const arr = [];
    return ()=>{
      const name = input.value.trim();
      const item = items.find(i=>i.name.toLowerCase()===name.toLowerCase());
      input.value='';
      if(!item) return alert('Not found: '+name);
      if(arr.some(x=>x.name===item.name)) return alert('Already added');
      arr.push(item);
      const li = document.createElement('li');
      const span = document.createElement('span');
      span.textContent = `${item.name} (V:${item.value}, D:${item.demand})`;
      const btn = document.createElement('button');
      btn.textContent='✖';
      btn.onclick=()=>{
        listEl.removeChild(li);
        arr.splice(arr.indexOf(item),1);
        compute();
      };
      li.append(span, btn);
      listEl.appendChild(li);
      compute();
    };
  }

  const addYour = makeAdder('your'), addTheir=makeAdder('their');
  document.getElementById('add-your').onclick=addYour;
  document.getElementById('add-their').onclick=addTheir;

  // 4) Compute & display result
  function compute(){
    const your = Array.from(document.querySelectorAll('#your-list li span'))
      .map(s=> items.find(i=>s.textContent.startsWith(i.name)));
    const their = Array.from(document.querySelectorAll('#their-list li span'))
      .map(s=> items.find(i=>s.name && s.name===s.textContent.split(' ')[0]));

    const sum = arr => arr.reduce((a,i)=>({value:a.value+i.value, demand:a.demand+i.demand}),{value:0,demand:0});
    const Y = sum(your), T = sum(their);
    const scoreY = 0.7*Y.value + 0.3*Y.demand;
    const scoreT = 0.7*T.value + 0.3*T.demand;

    document.getElementById('totals').textContent =
      `You: V=${Y.value}, D=${Y.demand}, S=${scoreY.toFixed(1)} | `+
      `Them: V=${T.value}, D=${T.demand}, S=${scoreT.toFixed(1)}`;

    const diff = scoreY - scoreT;
    let cls='fair', text='FAIR';
    if(Math.abs(diff)/Math.max(scoreY,scoreT,1) < 0.05) {
      cls='fair'; text='FAIR';
    } else if(diff>0) {
      cls='win'; text='WIN';
    } else {
      cls='lose'; text='LOSE';
    }
    const vEl = document.getElementById('verdict');
    vEl.className = cls;
    vEl.textContent = `Result: ${text}`;
  }
});
</script>
